<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" >
    <title>External API UI Extension Sample</title>
    <link rel="stylesheet" href="//unpkg.com/@contentful/forma-36-react-components@1.0.0/dist/styles.css">
    <script src="//unpkg.com/contentful-ui-extensions-sdk@3"></script>
    <script src="//unpkg.com/react/umd/react.development.js"></script>
    <script src="//unpkg.com/react-dom/umd/react-dom.development.js"></script>
    <script src="//unpkg.com/@contentful/forma-36-react-components@1.0.0/dist/umd/forma-36-react-components.development.min.js"></script>
</head>

<body>
    <div id="root"></div>

    <script type="text/javascript">
        // window.contentfulExtension.init(function (api) {
        //     api.window.startAutoResizer()
        //     var value = api.field.getValue()
        //     var serviceUri = "https://jsonplaceholder.typicode.com/users"

        //     $.ajax({
        //         url: serviceUri,
        //         type: "GET",
        //         crossDomain: true,
        //         dataType: "json",
        //         success: function (response) {
        //             response.forEach(function (value) {
        //                 var option = document.createElement("option")
        //                 option.setAttribute("value", value.id)
        //                 option.innerText = value.name

        //                 $("#user-id").append(option)
        //             })
        //             $("#user-id").val(api.field.getValue())
        //         },
        //         error: function (xhr, status) {
        //             console.log("Error fetching data. Status:", status)
        //         }
        //     })

        //     $("#user-id").on("input", function () {
        //         api.field.setValue(this.value)
        //     })
        // })

        const { SelectField, Option, Spinner } = Forma36;

        class App extends React.Component {
          state = {
            error: false,
            hasLoaded: false,
            items: [],
            value: ""
          };

          componentDidMount() {
            fetch("https://jsonplaceholder.typicode.com/users")
              .then(res => res.json())
              .then(
                items => {
                  this.setState({
                    hasLoaded: true,
                    items
                  });
                },

                error => {
                  this.setState({
                    hasLoaded: true,
                    error: error
                  });
                }
              );
          }

          onChange = ({ target: { value } }) => {
            this.setState({ value });
          };

          render() {
            return (
              <div>
                {this.state.hasLoaded ? (
                  <SelectField
                    name="names"
                    id="names"
                    labelText="Person name"
                    helpText="Get dummy user data from an external API"
                    onChange={this.onChange}
                  >
                    {this.state.items.map(item => (
                      <Option key={item.id} value={`${item.id}`}>
                        {item.name}
                      </Option>
                    ))}
                  </SelectField>
                ) : (
                  <Spinner />
                )}
              </div>
            );
          }
        }

        ReactDOM.render(<App />, document.getElementById("root"));
    </script>
</body>
</html>
